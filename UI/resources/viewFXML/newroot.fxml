<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/22"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="controllers.DashboardController"
            prefWidth="1200" prefHeight="700">

    <!-- ========== Top Bar ========== -->
    <top>
        <HBox spacing="10" BorderPane.alignment="CENTER_LEFT">
            <padding><Insets top="10" right="12" bottom="10" left="12"/></padding>

            <Label text="User Name:"/>
            <Label fx:id="userNameLabel" text="—"/>

            <Separator orientation="VERTICAL"/>

            <Button fx:id="loadFileButton" text="Load File Button"/>
            <TextField fx:id="loadedFilePathField" promptText="Currently Loaded File path"
                       editable="false" HBox.hgrow="ALWAYS"/>

            <Separator orientation="VERTICAL"/>

            <Label text="Available Credits:"/>
            <TextField fx:id="creditsField" prefWidth="80"/>
            <Button fx:id="chargeCreditsButton" text="Charge Credits"/>
            <Label text="credits"/>
        </HBox>
    </top>

    <!-- ========== Main Grid 2x2 ========== -->
    <center>
        <GridPane hgap="12" vgap="12">
            <padding><Insets top="12" right="12" bottom="12" left="12"/></padding>
            <columnConstraints>
                <ColumnConstraints percentWidth="50"/>
                <ColumnConstraints percentWidth="50"/>
            </columnConstraints>
            <rowConstraints>
                <RowConstraints percentHeight="50"/>
                <RowConstraints percentHeight="50"/>
            </rowConstraints>

            <!-- Top-Left: Connected Users -->
            <TitledPane text="Connected Users" collapsible="false"
                        GridPane.rowIndex="0" GridPane.columnIndex="0">
                <content>
                    <TableView fx:id="connectedUsersTable">
                        <columns>
                            <TableColumn fx:id="colCUName" text="Name" prefWidth="140"/>
                            <TableColumn fx:id="colCUMain" text="Main Programs" prefWidth="120"/>
                            <TableColumn fx:id="colCUFunctions" text="Functions" prefWidth="100"/>
                            <TableColumn fx:id="colCUCreds" text="Credits (current)" prefWidth="120"/>
                            <TableColumn fx:id="colCUUsed" text="Credits Used" prefWidth="110"/>
                            <TableColumn fx:id="colCURuns" text="Runs (run+debug)" prefWidth="130"/>
                        </columns>
                    </TableView>
                </content>
            </TitledPane>

            <!-- Top-Right: Available Programs (TableView) -->
            <TitledPane text="Available Programs" collapsible="false"
                        GridPane.rowIndex="0" GridPane.columnIndex="1">
                <content>
                    <VBox spacing="8" fillWidth="true">
                        <TableView fx:id="availableProgramsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="colProgramName" text="Program Name" prefWidth="120"/>
                                <TableColumn fx:id="colProgramUploader" text="Uploader" prefWidth="100"/>
                                <TableColumn fx:id="colProgramInstructions" text="Instructions" prefWidth="90"/>
                                <TableColumn fx:id="colProgramMaxLevel" text="Max Level" prefWidth="80"/>
                                <TableColumn fx:id="colProgramRunCount" text="Run Count" prefWidth="80"/>
                                <TableColumn fx:id="colProgramAvgCost" text="Avg Cost" prefWidth="80"/>
                            </columns>
                        </TableView>
                        <HBox alignment="CENTER_RIGHT">
                            <Button fx:id="executeProgramButton" text="Execute Program"/>
                        </HBox>
                    </VBox>
                </content>
            </TitledPane>

            <!-- Bottom-Left: Users History / Statistics Table -->
            <TitledPane text="Users History / Statistics Table" collapsible="false"
                        GridPane.rowIndex="1" GridPane.columnIndex="0">
                <content>
                    <TableView fx:id="historyTable" prefHeight="200" prefWidth="200">
                        <columns>
                            <TableColumn fx:id="colUser" text="User" prefWidth="120"/>
                            <TableColumn fx:id="colAction" text="Action" prefWidth="160"/>
                            <TableColumn fx:id="colTime" text="Time" prefWidth="180"/>
                        </columns>
                    </TableView>
                </content>
            </TitledPane>

            <!-- Bottom-Right: Available Functions -->
            <TitledPane text="Available Functions" collapsible="false"
                        GridPane.rowIndex="1" GridPane.columnIndex="1">
                <content>
                    <VBox spacing="8" fillWidth="true">
                        <TableView fx:id="functionsTable" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="colFnName" text="Function Name" prefWidth="150"/>
                                <TableColumn fx:id="colFnUploadProgram" text="Upload Program" prefWidth="150"/>
                                <TableColumn fx:id="colFnUploader" text="Uploader" prefWidth="120"/>
                                <TableColumn fx:id="colFnInstrCount" text="Instructions" prefWidth="100"/>
                                <TableColumn fx:id="colFnMaxDegree" text="Max Degree" prefWidth="100"/>
                            </columns>
                        </TableView>

                        <!-- חדש: כפתור Execute כמו ב-Programs -->
                        <HBox alignment="CENTER_RIGHT">
                            <Button fx:id="executeFunctionButton" text="Execute Function"/>
                        </HBox>
                    </VBox>
                </content>
            </TitledPane>


        </GridPane>
    </center>

</BorderPane>